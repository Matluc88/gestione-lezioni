{% if lezioni %}
<form id="lezioniForm">
    <input type="hidden" name="csrf_token" id="csrf_token" value="{{ csrf_token() }}">
    
    <!-- Desktop table view -->
    <div class="table-responsive d-none d-md-block">
        <table class="table table-bordered table-striped mt-4">
            <thead class="table-dark">
                <tr>
                    <th><input type="checkbox" id="select-all"> ‚úî</th>
                    <th>ID Corso</th>
                    <th>Materia</th>
                    <th>Data</th>
                    <th>Ora Inizio</th>
                    <th>Ora Fine</th>
                    <th>Luogo</th>
                    <th>Stato</th>
                    <th>Azioni</th>
                </tr>
            </thead>
            <tbody>
                {% for lezione in lezioni %}
                <tr>
                    <td><input type="checkbox" name="lezioni_selezionate[]" value="{{ lezione['id'] }}"></td>
                    <td>{{ lezione['id_corso'] }}</td>
                    <td>{{ lezione['materia'] }}</td>
                    <td>{{ lezione['data'] }}</td>
                    <td>{{ lezione['ora_inizio'] }}</td>
                    <td>{{ lezione['ora_fine'] }}</td>
                    <td>{{ lezione['luogo'] }}</td>
                    <td>
                        {% if lezione['stato'] == 'Completato' %}
                            <span class="badge bg-success">‚úÖ {{ lezione['stato'] }}</span>
                        {% elif lezione['stato'] == 'Pianificato' %}
                            <span class="badge bg-warning text-dark">üü° {{ lezione['stato'] }}</span>
                        {% else %}
                            <span class="badge bg-danger">‚ùå {{ lezione['stato'] }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('lezioni.modifica_lezione', lezione_id=lezione['id']) }}" class="btn btn-warning btn-sm">‚úèÔ∏è</a>
                        <button type="button" class="btn btn-danger btn-sm elimina-singola" data-id="{{ lezione['id'] }}">üóëÔ∏è</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Mobile card layout -->
    <div class="d-md-none mt-4">
        <div class="mb-3">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="select-all-mobile">
                <label class="form-check-label" for="select-all-mobile">Seleziona tutte le lezioni</label>
            </div>
        </div>
        {% for lezione in lezioni %}
        <div class="card mb-3 shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h6 class="card-title mb-0 fw-bold">{{ lezione['materia'] }}</h6>
                    <input type="checkbox" name="lezioni_selezionate[]" value="{{ lezione['id'] }}" class="form-check-input lezione-checkbox-mobile">
                </div>
                <p class="card-text mb-2 small">
                    <strong>Corso:</strong> {{ lezione['id_corso'] }}<br>
                    <strong>Data:</strong> {{ lezione['data'] }}<br>
                    <strong>Orario:</strong> {{ lezione['ora_inizio'] }} - {{ lezione['ora_fine'] }}<br>
                    <strong>Luogo:</strong> {{ lezione['luogo'] }}
                </p>
                <div class="d-flex justify-content-between align-items-center">
                    {% if lezione['stato'] == 'Completato' %}
                        <span class="badge bg-success">‚úÖ {{ lezione['stato'] }}</span>
                    {% elif lezione['stato'] == 'Pianificato' %}
                        <span class="badge bg-warning text-dark">üü° {{ lezione['stato'] }}</span>
                    {% else %}
                        <span class="badge bg-danger">‚ùå {{ lezione['stato'] }}</span>
                    {% endif %}
                    <div>
                        <a href="{{ url_for('lezioni.modifica_lezione', lezione_id=lezione['id']) }}" class="btn btn-warning btn-sm me-1">‚úèÔ∏è</a>
                        <button type="button" class="btn btn-danger btn-sm elimina-singola" data-id="{{ lezione['id'] }}">üóëÔ∏è</button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</form>

<style>
    @media (max-width: 767px) {
        .btn-sm {
            min-height: 36px;
            padding: 8px 12px;
        }
        .card-body {
            padding: 1rem;
        }
        .badge {
            font-size: 0.8rem;
        }
    }
    
    @media (max-width: 393px) {
        .btn-sm {
            min-height: 40px;
            padding: 10px 14px;
            font-size: 0.8rem;
        }
        .card-body {
            padding: 0.75rem;
        }
        .badge {
            font-size: 0.75rem;
        }
        .card-title {
            font-size: 0.9rem;
        }
        .card-text {
            font-size: 0.8rem;
        }
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const selectAllMobile = document.getElementById('select-all-mobile');
    const lezioneCheckboxesMobile = document.querySelectorAll('.lezione-checkbox-mobile');
    
    if (selectAllMobile) {
        selectAllMobile.addEventListener('change', function() {
            lezioneCheckboxesMobile.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });
    }
});
</script>

{% else %}
<p class="text-center text-muted mt-4">üì≠ Nessuna lezione trovata. Modifica i filtri o aggiungi una nuova lezione.</p>
{% endif %}
