{% extends "base_ios.html" %}

{% block title %}Carica Contratto{% endblock %}

{% set large_title = "Carica Contratto" %}

{% block content %}
<div class="ios-page">
    <form method="POST" action="{{ url_for('contratti.upload_contratto') }}" enctype="multipart/form-data" class="ios-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <div class="ios-card">
            <div class="ios-card-header">
                <h3 class="ios-card-title">ðŸ“„ Informazioni Contratto</h3>
            </div>
            <div class="ios-card-body">
                <!-- File PDF -->
                <div class="ios-form-group">
                    <label class="ios-label" for="file">File PDF *</label>
                    <input type="file" 
                           class="ios-input" 
                           id="file" 
                           name="file" 
                           accept=".pdf"
                           required
                           onchange="updateFileName(this)">
                    <small class="ios-help-text">Formato PDF, massimo 10MB</small>
                    <div id="fileName" class="file-name-display"></div>
                </div>

                <!-- Numero Contratto -->
                <div class="ios-form-group">
                    <label class="ios-label" for="numero_contratto">Numero Contratto</label>
                    <input type="text" 
                           class="ios-input" 
                           id="numero_contratto" 
                           name="numero_contratto"
                           placeholder="Es: CTR-2026-001">
                    <small class="ios-help-text">Opzionale - puÃ² essere estratto automaticamente</small>
                </div>

                <!-- Cliente -->
                <div class="ios-form-group">
                    <label class="ios-label" for="cliente">Cliente/Studente</label>
                    <input type="text" 
                           class="ios-input" 
                           id="cliente" 
                           name="cliente"
                           placeholder="Nome del cliente">
                    <small class="ios-help-text">Opzionale - puÃ² essere estratto automaticamente</small>
                </div>

                <!-- Collega a Corso -->
                <div class="ios-form-group">
                    <label class="ios-label" for="id_corso">Collega a Corso (Opzionale)</label>
                    <select class="ios-select" id="id_corso" name="id_corso">
                        <option value="">-- Nessun corso --</option>
                        {% for corso in corsi %}
                        <option value="{{ corso.id_corso }}">
                            {{ corso.nome }}{% if corso.cliente %} ({{ corso.cliente }}){% endif %}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        <div class="ios-card info-card">
            <div class="ios-card-body">
                <div class="info-icon">ðŸ¤–</div>
                <h4>Analisi AI con Claude</h4>
                <p>Dopo il caricamento, Claude AI analizzerÃ  automaticamente il contratto ed estrarrÃ  le informazioni chiave. Potrai poi fare domande in linguaggio naturale come:</p>
                <ul class="example-list">
                    <li>"Dammi il numero del corso"</li>
                    <li>"Qual Ã¨ il compenso orario?"</li>
                    <li>"Quali sono le date del contratto?"</li>
                    <li>"Quante ore sono previste?"</li>
                </ul>
            </div>
        </div>

        <div class="ios-button-group">
            <button type="submit" class="ios-button ios-button-primary ios-button-block">
                ðŸ“¤ Carica e Analizza
            </button>
            <a href="{{ url_for('contratti.lista_contratti') }}" class="ios-button ios-button-secondary ios-button-block">
                Annulla
            </a>
        </div>
    </form>
</div>

<style>
.ios-form {
    padding-bottom: 20px;
}

.ios-card {
    margin-bottom: 20px;
}

.ios-form-group {
    margin-bottom: 20px;
}

.ios-form-group:last-child {
    margin-bottom: 0;
}

.ios-label {
    display: block;
    font-size: 15px;
    font-weight: 600;
    color: var(--ios-text-primary);
    margin-bottom: 8px;
}

.ios-input, .ios-select {
    width: 100%;
    padding: 12px 16px;
    font-size: 16px;
    border: 1px solid var(--ios-separator);
    border-radius: var(--radius-md);
    background-color: var(--ios-background);
    color: var(--ios-text-primary);
    transition: border-color 0.2s;
}

.ios-input:focus, .ios-select:focus {
    outline: none;
    border-color: var(--ios-blue);
}

.ios-help-text {
    display: block;
    font-size: 13px;
    color: var(--ios-text-tertiary);
    margin-top: 6px;
}

.file-name-display {
    margin-top: 10px;
    padding: 10px;
    background-color: var(--ios-background);
    border-radius: var(--radius-sm);
    font-size: 14px;
    color: var(--ios-blue);
    display: none;
}

.file-name-display.show {
    display: block;
}

.info-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.info-card .ios-card-body {
    text-align: center;
}

.info-icon {
    font-size: 48px;
    margin-bottom: 15px;
}

.info-card h4 {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 10px;
}

.info-card p {
    font-size: 15px;
    line-height: 1.5;
    margin-bottom: 15px;
    opacity: 0.9;
}

.example-list {
    text-align: left;
    display: inline-block;
    list-style: none;
    padding: 0;
    margin: 0;
}

.example-list li {
    padding: 8px 0;
    font-size: 14px;
    opacity: 0.9;
}

.example-list li:before {
    content: "ðŸ’¬ ";
    margin-right: 8px;
}

.ios-button-group {
    margin-top: 30px;
}
</style>

<script>
function updateFileName(input) {
    const fileDisplay = document.getElementById('fileName');
    if (input.files && input.files[0]) {
        const fileName = input.files[0].name;
        const fileSize = (input.files[0].size / 1024 / 1024).toFixed(2);
        fileDisplay.textContent = `ðŸ“„ ${fileName} (${fileSize} MB)`;
        fileDisplay.classList.add('show');
    } else {
        fileDisplay.classList.remove('show');
    }
}
</script>
{% endblock %}
